# Context-Keeper æ¶æ„è®¾è®¡å¯¹æ¯”

## âŒ å½“å‰å¤æ‚æ¶æ„çš„é—®é¢˜

### æµç¨‹å›¾åˆ†æ
```
Cursor MCP Client â†’ MCP Server â†’ WebSocket â†’ VSCodeæ‰©å±• â†’ æœ¬åœ°æ“ä½œ â†’ å›æŠ¥æˆåŠŸ
```

### é—®é¢˜è¯†åˆ«

1. **åŒå®¢æˆ·ç«¯è®¾è®¡**
   - `cursor mcp client` - Cursorçš„MCPå®¢æˆ·ç«¯
   - `vscodeæ‰©å±•æœºåˆ¶ mcp-client.js` - æˆ‘ä»¬çš„æ‰©å±•å®¢æˆ·ç«¯
   - **é—®é¢˜**: ä¸¤ä¸ªå®¢æˆ·ç«¯åŠŸèƒ½é‡å¤ï¼Œæ¶æ„å¤æ‚

2. **WebSocketæ¨é€æœºåˆ¶**
   - æœåŠ¡å™¨éœ€è¦ä¸»åŠ¨æ¨é€æŒ‡ä»¤ç»™æ‰©å±•
   - **é—®é¢˜**: å¢åŠ äº†è¿æ¥ç®¡ç†ã€é‡è¿ã€çŠ¶æ€åŒæ­¥ç­‰å¤æ‚æ€§

3. **å¤šæ­¥éª¤æµç¨‹**
   - è¯·æ±‚ â†’ æœåŠ¡å™¨ â†’ æ¨é€ â†’ æ‰§è¡Œ â†’ å›æŠ¥ â†’ å“åº”
   - **é—®é¢˜**: 6ä¸ªæ­¥éª¤ï¼Œä»»ä½•ä¸€æ­¥å¤±è´¥éƒ½ä¼šå¯¼è‡´æ•´ä½“å¤±è´¥

4. **æŠ€æœ¯æ ˆæ··ä¹±**
   - MCPåè®® + WebSocket + HTTP + VSCode API
   - **é—®é¢˜**: ç»´æŠ¤æˆæœ¬é«˜ï¼Œè°ƒè¯•å›°éš¾

## âœ… æ¨èçš„ç®€åŒ–æ¶æ„

### æ ¸å¿ƒç†å¿µï¼š**ä¸€ä¸ªæ‰©å±•è§£å†³æ‰€æœ‰é—®é¢˜**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Cursor/VSCode                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Context-Keeper Extension              â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚   â”‚
â”‚  â”‚  â”‚ Event       â”‚    â”‚ HTTP Client      â”‚        â”‚   â”‚
â”‚  â”‚  â”‚ Listeners   â”‚    â”‚ (axios)          â”‚        â”‚   â”‚
â”‚  â”‚  â”‚             â”‚    â”‚                  â”‚        â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ onSave    â”‚    â”‚ â€¢ POST /mcp      â”‚        â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ onOpen    â”‚    â”‚ â€¢ ç›´æ¥è°ƒç”¨API    â”‚        â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ onChange  â”‚    â”‚ â€¢ å¤„ç†å“åº”       â”‚        â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚   â”‚
â”‚  â”‚  â”‚ Local File  â”‚    â”‚ UI Components    â”‚        â”‚   â”‚
â”‚  â”‚  â”‚ Operations  â”‚    â”‚                  â”‚        â”‚   â”‚
â”‚  â”‚  â”‚             â”‚    â”‚ â€¢ Status Bar     â”‚        â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Write     â”‚    â”‚ â€¢ Context Menu   â”‚        â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Read      â”‚    â”‚ â€¢ Webview Panel  â”‚        â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Manage    â”‚    â”‚ â€¢ Quick Picks    â”‚        â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTP
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Context-Keeper MCP Server                     â”‚
â”‚                                                             â”‚
â”‚  â€¢ æ•°æ®å¤„ç†å’Œå­˜å‚¨                                          â”‚
â”‚  â€¢ å‘é‡æœç´¢                                                â”‚
â”‚  â€¢ ä¼šè¯ç®¡ç†                                                â”‚
â”‚  â€¢ APIå…¼å®¹æ€§                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¼˜åŠ¿å¯¹æ¯”

| æ–¹é¢ | å¤æ‚æ¶æ„ | ç®€åŒ–æ¶æ„ |
|------|----------|----------|
| **å®¢æˆ·ç«¯æ•°é‡** | 2ä¸ª (Cursor MCP + VSCodeæ‰©å±•) | 1ä¸ª (VSCodeæ‰©å±•) |
| **é€šä¿¡æ–¹å¼** | MCP + WebSocket + HTTP | HTTP only |
| **æµç¨‹æ­¥éª¤** | 6æ­¥ | 2æ­¥ |
| **é”™è¯¯å¤„ç†** | å¤šç‚¹å¤±è´¥ | å•ç‚¹æ§åˆ¶ |
| **ç»´æŠ¤æˆæœ¬** | é«˜ | ä½ |
| **è°ƒè¯•éš¾åº¦** | å›°éš¾ | ç®€å• |
| **ç”¨æˆ·ä½“éªŒ** | å»¶è¿Ÿé«˜ | å“åº”å¿« |

### å®ç°ç¤ºä¾‹

#### ç®€åŒ–çš„äº‹ä»¶å¤„ç†
```typescript
class ContextKeeperExtension {
    // æ–‡ä»¶ä¿å­˜æ—¶çš„å®Œæ•´æµç¨‹
    private async onFileSave(document: vscode.TextDocument) {
        try {
            // 1. ç›´æ¥è°ƒç”¨MCPæœåŠ¡å™¨
            const response = await this.httpClient.post('/mcp', {
                method: 'store_conversation',
                params: {
                    sessionId: this.sessionId,
                    filePath: document.uri.fsPath,
                    content: document.getText()
                }
            });
            
            // 2. å¤„ç†å“åº”ä¸­çš„æœ¬åœ°æŒ‡ä»¤
            if (response.data.localInstruction) {
                await this.executeLocalInstruction(response.data.localInstruction);
            }
            
            // 3. æ›´æ–°UI
            this.updateStatusBar('âœ… å·²ä¿å­˜è®°å¿†');
            
        } catch (error) {
            this.updateStatusBar('âŒ ä¿å­˜å¤±è´¥');
            console.error('Failed to store memory:', error);
        }
    }
    
    // ç›´æ¥æ‰§è¡Œæœ¬åœ°æŒ‡ä»¤
    private async executeLocalInstruction(instruction: any) {
        switch (instruction.type) {
            case 'short_memory':
                await this.writeToFile(instruction.target, instruction.content);
                break;
            case 'session_data':
                await this.saveSessionData(instruction);
                break;
        }
    }
}
```

#### å»é™¤WebSocketçš„å¥½å¤„
```typescript
// âŒ å¤æ‚çš„WebSocketç®¡ç†
class ComplexClient {
    private websocket: WebSocket;
    private reconnectTimer: NodeJS.Timeout;
    private messageQueue: any[] = [];
    
    async connect() {
        // è¿æ¥ç®¡ç†
        // é‡è¿é€»è¾‘  
        // æ¶ˆæ¯é˜Ÿåˆ—
        // çŠ¶æ€åŒæ­¥
        // ...100+ è¡Œä»£ç 
    }
}

// âœ… ç®€å•çš„HTTPå®¢æˆ·ç«¯
class SimpleClient {
    async callAPI(method: string, params: any) {
        return await axios.post('/mcp', { method, params });
    }
}
```

## ğŸ¯ è¿ç§»å»ºè®®

### ç¬¬1æ­¥ï¼šæ›¿æ¢Cursor MCP Client
```typescript
// å½“å‰: Cursoré€šè¿‡MCPè°ƒç”¨
// ç›®æ ‡: ç›´æ¥ä½¿ç”¨VSCodeæ‰©å±•

// åœ¨VSCodeæ‰©å±•ä¸­æ³¨å†Œæ‰€æœ‰MCPåŠŸèƒ½
vscode.commands.registerCommand('contextKeeper.storeMemory', async () => {
    // ç›´æ¥å¤„ç†ï¼Œæ— éœ€é€šè¿‡MCPåè®®
});
```

### ç¬¬2æ­¥ï¼šç§»é™¤WebSocket
```typescript
// å½“å‰: æœåŠ¡å™¨æ¨é€æŒ‡ä»¤
// ç›®æ ‡: æ‰©å±•ä¸»åŠ¨è°ƒç”¨å¹¶ç›´æ¥æ‰§è¡Œç»“æœ

const response = await this.callMCPServer(method, params);
if (response.localInstruction) {
    await this.executeLocally(response.localInstruction);
}
```

### ç¬¬3æ­¥ï¼šç»Ÿä¸€å…¥å£ç‚¹
```typescript
// æ‰€æœ‰åŠŸèƒ½éƒ½é€šè¿‡VSCodeæ‰©å±•å…¥å£
export function activate(context: vscode.ExtensionContext) {
    const extension = new ContextKeeperExtension(context);
    
    // æ³¨å†Œæ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
    extension.registerEventListeners();
    
    // æ³¨å†Œæ‰€æœ‰å‘½ä»¤
    extension.registerCommands();
    
    // è¿æ¥MCPæœåŠ¡å™¨
    extension.connectToServer();
}
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | å¤æ‚æ¶æ„ | ç®€åŒ–æ¶æ„ | æ”¹è¿› |
|------|----------|----------|------|
| **å“åº”æ—¶é—´** | 500-1000ms | 100-200ms | 75%â†“ |
| **å†…å­˜å ç”¨** | ~50MB | ~20MB | 60%â†“ |
| **ä»£ç è¡Œæ•°** | ~2000è¡Œ | ~800è¡Œ | 60%â†“ |
| **æµ‹è¯•å¤æ‚åº¦** | é«˜ | ä½ | æ˜æ˜¾æ”¹å–„ |

## ğŸš€ æ€»ç»“

**ç®€åŒ–æ¶æ„çš„æ ¸å¿ƒç†å¿µ**ï¼š
1. **ä¸€ä¸ªæ‰©å±•ç»Ÿä¸€ç®¡ç†** - ä¸éœ€è¦å¤šä¸ªå®¢æˆ·ç«¯
2. **ç›´æ¥HTTPé€šä¿¡** - å»é™¤WebSocketå¤æ‚æ€§
3. **æœ¬åœ°ç›´æ¥æ‰§è¡Œ** - å‡å°‘ç½‘ç»œå¾€è¿”
4. **äº‹ä»¶é©±åŠ¨è®¾è®¡** - å“åº”å¼æ¶æ„

è¿™æ ·çš„è®¾è®¡**æ›´ç®€å•ã€æ›´å¿«é€Ÿã€æ›´å¯é **ï¼ 