# Context-Keeper 环境变量配置

# =================================
# 基础服务配置
# =================================
SERVICE_NAME=context-keeper
PORT=8088
DEBUG=false
STORAGE_PATH=./data

# =================================
# 阿里云文本嵌入服务配置
# =================================
EMBEDDING_API_URL=https://dashscope.aliyuncs.com/compatible-mode/v1/embeddings
EMBEDDING_API_KEY=

# 🔥 批量Embedding配置
BATCH_EMBEDDING_API_URL=https://dashscope.aliyuncs.com/api/v1/services/embeddings/text-embedding/text-embedding
BATCH_EMBEDDING_API_KEY=
BATCH_QUEUE_SIZE=100
BATCH_WORKER_POLL_INTERVAL=5s
BATCH_MAX_RETRIES=100

# =================================
# 向量存储配置
# =================================

# 向量存储类型选择: aliyun | vearch
VECTOR_STORE_TYPE=aliyun

# 阿里云向量数据库配置
VECTOR_DB_URL=https://vrs-cn-hic4apgaa00049.dashvector.cn-hangzhou.aliyuncs.com
VECTOR_DB_API_KEY=
VECTOR_DB_COLLECTION=context_keeper
VECTOR_DB_DIMENSION=1536
VECTOR_DB_METRIC=cosine
SIMILARITY_THRESHOLD=0.3

# =================================
# Vearch 向量数据库配置
# =================================
VEARCH_URL=http://context-keeper.vearch.jd.local
VEARCH_USERNAME=
VEARCH_PASSWORD=
VEARCH_DATABASE=db
VEARCH_DIMENSION=1536
VEARCH_METRIC=inner_product
VEARCH_SIMILARITY_THRESHOLD=0.2

# Vearch 必需的表空间列表（逗号分隔，启动时检查）
VEARCH_REQUIRED_SPACES=context_keeper_vector,context_keeper_users

# Vearch 性能配置
VEARCH_CONNECTION_POOL_SIZE=10
VEARCH_REQUEST_TIMEOUT=30
VEARCH_DEFAULT_TOP_K=10

# =================================
# 时间阈值配置 (新增)
# =================================

# 会话管理相关
SESSION_TIMEOUT=720m            # 会话超时时间，默认30分钟
CLEANUP_INTERVAL=30m           # 后台清理任务执行间隔，默认10分钟  
SHORT_MEMORY_MAX_AGE=2        # 短期记忆保留天数，默认2天

# 自动汇总相关
SUMMARY_INTERVAL_MULTIPLIER=5  # 自动汇总间隔倍数（相对于清理间隔），默认5倍
MIN_MESSAGE_COUNT=20           # 最小消息数阈值，少于此数量不汇总，默认20
MIN_TIME_SINCE_LAST_SUMMARY=24 # 距离上次汇总的最小小时数，默认24小时
MAX_MESSAGE_COUNT=100          # 触发汇总的消息数阈值，默认100

USER_REPOSITORY_TYPE=aliyun

# =================================
# LLM驱动智能化配置
# =================================

# LLM驱动功能总开关
LLM_DRIVEN_ENABLED=true
LLM_DRIVEN_SEMANTIC_ANALYSIS=true
LLM_DRIVEN_MULTI_DIMENSIONAL=true
LLM_DRIVEN_CONTENT_SYNTHESIS=true

# LLM提供商配置
LLM_PROVIDER=ollama_local
LLM_MODEL=deepseek-coder-v2:16b
LLM_MAX_TOKENS=80000
LLM_TEMPERATURE=0.1
LLM_TIMEOUT_SECONDS=600

# 语料分析策略配置
SEMANTIC_ANALYSIS_STRATEGY=lightweight        # lightweight | deepIntent
ENABLE_STRATEGY_COMPARISON=false              # 是否开启策略对比模式

# =================================
# LLM API Keys 配置
# =================================

# DeepSeek API Key
DEEPSEEK_API_KEY=

# 其他LLM提供商API密钥（可选）
OPENAI_API_KEY=
CLAUDE_API_KEY=
QIANWEN_API_KEY=

# =================================
# 多维度存储配置
# =================================
ENABLE_MULTI_DIMENSIONAL_STORAGE=true
MULTI_DIM_TIMELINE_ENABLED=true
MULTI_DIM_KNOWLEDGE_ENABLED=true
MULTI_DIM_VECTOR_ENABLED=true
MULTI_DIM_LLM_PROVIDER=ollama_local
MULTI_DIM_LLM_MODEL=deepseek-coder-v2:16b
MULTI_DIM_LLM_TIMEOUT_SECONDS=600


INTERCEPT_MCP_TOOLS=retrieve_context,store_conversation,retrieve_memory,memorize_context,retrieve_todos

KNOWLEDGE_GRAPH_EXTRACTION_MODE=enhanced_prompt
LLM_DRIVEN_SHORT_TERM_MEMORY = false

#* *时间线存储开关*
TIMELINE_STORAGE_ENABLED=true
# TimescaleDB/PostgreSQL* *连接配置*
TIMESCALEDB_HOST=
TIMESCALEDB_PORT=
TIMESCALEDB_DATABASE=context_keeper_timeline
TIMESCALEDB_USERNAME=
TIMESCALEDB_PASSWORD=
TIMESCALEDB_SSL_MODE=disable
#* *连接池配置*
TIMESCALEDB_MAX_CONNS=10
TIMESCALEDB_MAX_IDLE_TIME=5m

#* *知识图谱存储开关*
KNOWLEDGE_GRAPH_ENABLED=true
# Neo4j* *连接配置*
NEO4J_URI=bolt://localhost:7687
NEO4J_USERNAME=
NEO4J_PASSWORD=
NEO4J_DATABASE=neo4j
# Neo4j* *连接池配置*
NEO4J_MAX_CONNECTION_POOL_SIZE=50
NEO4J_CONNECTION_TIMEOUT=30s
NEO4J_MAX_TRANSACTION_RETRY_TIME=15s